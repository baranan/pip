define(function(require){			var   sourceSequence 	= require('./sourceSequence')		, trialSequence 	= require('./trialSequence') 		, Trial 			= require('app/trial/trial_constructor')		, logger 			= require('app/task/logger')		, settings 			= require('app/task/settings')		, pubsub			= require('utils/pubsub');		/*	 * the function that plays the source sequence	 */		// check if we have another trial, if so plays it, if not ends the task	var nextTrial = function(){		// if we have another trial play it (next() both returns the next trial and sets it as current)		if (sourceSequence.next()) {														// create new trial and activate it						var trial = new Trial(sourceSequence.current());			trial				.activate()						// activate the trial				.done(function(){					pubsub.publish('log:send');	// see if we need to send the log stack					nextTrial();				// when we're done try to play the next one				});													// push trial into the trial sequence							trialSequence.add(trial);		}					else logger().done(function(){						if (settings.hooks.endTask) settings.hooks.endTask.call(); 			else window.location.href = settings.redirect || window.location.href; 		});					}		return nextTrial;});